<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë§¤ì¶œ ì…ë ¥ê¸° (ë³µë¶™ ì§€ì›)</title>
  <style>
    body {font-family: -apple-system, sans-serif; margin:0; background:#f9f9f9; padding:15px;}
    .container {background:#fff; padding:20px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,.1);}
    table {width:100%; border-collapse:collapse; margin:15px 0;}
    th, td {border:1px solid #ddd; padding:12px; text-align:left; font-size:15px;}
    th {background:#f0f0f0;}
    input, textarea {width:100%; padding:10px; border:1px solid #ccc; border-radius:6px; box-sizing:border-box; font-size:15px;}
    .total {background:#e3f2fd; font-weight:bold;}
    button {padding:14px; margin:8px 0; border:none; border-radius:8px; color:#fff; font-size:16px; cursor:pointer; width:100%;}
    .save {background:#007bff;}
    .clear {background:#6c757d;}
    .delete {background:#dc3545;}
    .export {background:#28a745;}
    .paste {background:#fd7e14;}
    .cumulative {background:#fff8e1; padding:15px; border-radius:8px; margin:15px 0; font-size:15px;}
    .info {background:#d1ecf1; padding:12px; border-radius:8px; margin-bottom:15px; font-size:14px;}
  </style>
</head>
<body>
<div class="container">
  <h2 style="text-align:center; margin-bottom:20px;">ë§¤ì¶œ ì…ë ¥ê¸° (ë³µë¶™ ê°€ëŠ¥)</h2>

  <div class="info">
    <strong>ğŸ“‹ ë³µë¶™ ë°©ë²•</strong><br>
    1. ì•„ë˜ ì–‘ì‹ ë³µì‚¬<br>
    2. <strong>ë³µë¶™ ë²„íŠ¼</strong> í´ë¦­ â†’ ìë™ ì…ë ¥
  </div>

  <button class="paste" onclick="openPaste()">ğŸ“‹ ë³µë¶™ ì…ë ¥</button>

  <table id="form">
    <tr><th>í•­ëª©</th><th>ì…ë ¥</th></tr>
    <tr><td>ë‚ ì§œ</td><td><input type="text" id="date" placeholder="11/4" /></td></tr>
    <tr><td>í™€</td><td><input type="number" id="hol" oninput="calc()" /></td></tr>
    <tr><td>ë°°</td><td><input type="number" id="bae" oninput="calc()" /></td></tr>
    <tr><td>ì¿ </td><td><input type="number" id="ku" oninput="calc()" /></td></tr>
    <tr><td>ìš”</td><td><input type="number" id="yo" oninput="calc()" /></td></tr>
    <tr class="total"><td>í•©ê³„</td><td id="total">0 ì›</td></tr>
    <tr><td>ì¹´ì˜¤ìœ„</td><td><input type="number" step="0.1" id="kaowi" /></td></tr>
    <tr><td>ìˆœì‚´</td><td><input type="number" step="0.1" id="sunsal" /></td></tr>
    <tr><td>ìµì¼ ê·¼ë¬´ì</td><td><textarea id="worker" rows="2"></textarea></td></tr>
    <tr><td>ìµì¼ íœ´ë¬´ì</td><td><textarea id="off" rows="2"></textarea></td></tr>
  </table>

  <button class="save" onclick="save()">ì €ì¥</button>
  <button class="clear" onclick="resetForm()">ì…ë ¥ ì´ˆê¸°í™”</button>
  <button class="delete" onclick="deleteAll()">ì „ì²´ ì‚­ì œ</button>
  <button class="export" onclick="exportCSV()">CSV ë‚´ë³´ë‚´ê¸°</button>

  <div class="cumulative" id="cumulative"><strong>ë°ì´í„° ì—†ìŒ</strong></div>
</div>

<!-- ë³µë¶™ ì…ë ¥ íŒì—… -->
<div id="pasteModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:999;">
  <div style="background:#fff; margin:15% auto; padding:20px; width:90%; max-width:500px; border-radius:12px;">
    <h3>ë³µë¶™ ì…ë ¥</h3>
    <textarea id="pasteText" placeholder="ì—¬ê¸°ì— ë³µì‚¬í•œ í…ìŠ¤íŠ¸ ë¶™ì—¬ë„£ê¸°" style="width:100%; height:200px; padding:10px; font-size:14px;"></textarea>
    <div style="text-align:center; margin-top:15px;">
      <button onclick="parsePaste()" style="background:#007bff; color:#fff; padding:12px 20px; border:none; border-radius:8px;">íŒŒì‹± & ì…ë ¥</button>
      <button onclick="closePaste()" style="background:#6c757d; color:#fff; padding:12px 20px; border:none; border-radius:8px; margin-left:10px;">ì·¨ì†Œ</button>
    </div>
  </div>
</div>

<script>
const KEY = 'salesData';

function calc() {
  const sum = (parseFloat(document.getElementById('hol').value)||0) + 
              (parseFloat(document.getElementById('bae').value)||0) + 
              (parseFloat(document.getElementById('ku').value)||0) + 
              (parseFloat(document.getElementById('yo').value)||0);
  document.getElementById('total').textContent = sum.toLocaleString() + ' ì›';
}

function normalizeDate(d) {
  if (!d) return null;
  const [m, day] = d.split(/[/\-]/);
  return m && day ? `${m.padStart(2,'0')}-${day.padStart(2,'0')}` : null;
}

// ë³µë¶™ íŒì—… ì—´ê¸°
function openPaste() {
  document.getElementById('pasteModal').style.display = 'block';
  document.getElementById('pasteText').focus();
}

// ë‹«ê¸°
function closePaste() {
  document.getElementById('pasteModal').style.display = 'none';
}

// íŒŒì‹± & ì…ë ¥
function parsePaste() {
  const text = document.getElementById('pasteText').value.trim();
  if (!text) return alert('í…ìŠ¤íŠ¸ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.');
  
  const lines = text.split('\n').map(l => l.trim());
  let date = '', hol = 0, bae = 0, ku = 0, yo = 0, kaowi = 0, sunsal = 0, worker = '', off = '';
  
  lines.forEach(line => {
    if (line.match(/^\d+\/\d+/)) {
      date = line.split(' ')[0]; // 11/4
    } else if (line.includes('í™€')) {
      hol = parseFloat(line.replace(/[^\d]/g, '')) || 0;
    } else if (line.includes('ë°°')) {
      bae = parseFloat(line.replace(/[^\d]/g, '')) || 0;
    } else if (line.includes('ì¿ ')) {
      ku = parseFloat(line.replace(/[^\d]/g, '')) || 0;
    } else if (line.includes('ìš”')) {
      yo = parseFloat(line.replace(/[^\d]/g, '')) || 0;
    } else if (line.includes('ì¹´ì˜¤ìœ„')) {
      kaowi = parseFloat(line.replace(/[^\d.]/g, '')) || 0;
    } else if (line.includes('ìˆœì‚´')) {
      sunsal = parseFloat(line.replace(/[^\d.]/g, '')) || 0;
    } else if (line.includes('ê·¼ë¬´ì')) {
      worker = line.split(':')[1]?.trim() || '';
    } else if (line.includes('íœ´ë¬´ì')) {
      off = line.split(':')[1]?.trim() || '';
    }
  });

  if (!date) return alert('ë‚ ì§œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');

  // ì…ë ¥ í•„ë“œì— ìë™ ì±„ìš°ê¸°
  document.getElementById('date').value = date;
  document.getElementById('hol').value = hol;
  document.getElementById('bae').value = bae;
  document.getElementById('ku').value = ku;
  document.getElementById('yo').value = yo;
  document.getElementById('kaowi').value = kaowi;
  document.getElementById('sunsal').value = sunsal;
  document.getElementById('worker').value = worker;
  document.getElementById('off').value = off;

  calc();
  closePaste();
  alert('ìë™ ì…ë ¥ ì™„ë£Œ! ì €ì¥ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.');
}

function save() {
  const date = normalizeDate(document.getElementById('date').value);
  if (!date) return alert('ë‚ ì§œ ì…ë ¥');
  const total = parseFloat(document.getElementById('total').textContent.replace(/[^0-9]/g,'')) || 0;
  const data = {
    date, hol: +document.getElementById('hol').value || 0,
    bae: +document.getElementById('bae').value || 0,
    ku: +document.getElementById('ku').value || 0,
    yo: +document.getElementById('yo').value || 0,
    total, kaowi: +document.getElementById('kaowi').value || 0,
    sunsal: +document.getElementById('sunsal').value || 0,
    worker: document.getElementById('worker').value,
    off: document.getElementById('off').value
  };
  let list = JSON.parse(localStorage.getItem(KEY) || '[]');
  list.push(data);
  localStorage.setItem(KEY, JSON.stringify(list));
  alert('ì €ì¥ë¨');
  resetForm();
  updateCum();
}

function resetForm() {
  document.getElementById('form').reset();
  calc();
}

function deleteAll() {
  if (confirm('ëª¨ë“  ë°ì´í„° ì‚­ì œ?')) {
    localStorage.setItem(KEY, '[]');
    updateCum();
    alert('ì‚­ì œ ì™„ë£Œ');
  }
}

function updateCum() {
  const list = JSON.parse(localStorage.getItem(KEY) || '[]');
  if (!list.length) {
    document.getElementById('cumulative').innerHTML = '<strong>ë°ì´í„° ì—†ìŒ</strong>';
    return;
  }
  const total = list.reduce((s, r) => s + r.total, 0);
  const kaowi = list.reduce((s, r) => s + r.kaowi, 0);
  const sunsal = list.reduce((s, r) => s + r.sunsal, 0);
  document.getElementById('cumulative').innerHTML = `
    <strong>ëˆ„ì </strong><br>
    ë§¤ì¶œ: <strong>${total.toLocaleString()} ì›</strong><br>
    ì¹´ì˜¤ìœ„: <strong>${kaowi.toFixed(1)}</strong> | ìˆœì‚´: <strong>${sunsal.toFixed(1)}</strong>
  `;
}

function exportCSV() {
  const date = normalizeDate(document.getElementById('date').value);
  if (!date) return alert('ë‚ ì§œ ì…ë ¥');
  const [month] = date.split('-');
  const list = JSON.parse(localStorage.getItem(KEY) || '[]');
  let csv = '\ufeffë‚ ì§œ,í™€,ë°°,ì¿ ,ìš”,í•©ê³„,ì¹´ì˜¤ìœ„,ìˆœì‚´,ê·¼ë¬´ì,íœ´ë¬´ì\n';
  list.filter(r => r.date.startsWith(month + '-')).forEach(r => {
    csv += `${r.date},${r.hol},${r.bae},${r.ku},${r.yo},${r.total},${r.kaowi},${r.sunsal},"${r.worker}","${r.off}"\n`;
  });
  const blob = new Blob([csv], {type: 'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = `ë§¤ì¶œ_${month}.csv`; a.click();
}

window.onload = () => { calc(); updateCum(); };
</script>
</body>
</html>
